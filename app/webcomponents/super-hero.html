<polymer-element name="super-hero" attributes="heroId">
    <template>
        <link rel="stylesheet" href="../styles/super-hero.css">
        <div class="col-lg-4">
            <div id="box" class="hero">
                <span class="profile">
                    <img src="{{ hero.thumbnail.path + '.' + hero.thumbnail.extension }}">
                </span>

                <div class="info">
                    <div class="desc">
                        <strong>{{ hero.name }}</strong>
                        <span>{{ hero.description }}</span>
                    </div>
                </div>
                <div class="fights">
                    {{ success }}% |
                    <span style="color: green">{{ wins }} <span class="glyphicon glyphicon-thumbs-up"></span></span> |
                    <span style="color: red">{{ losses }} <span class="glyphicon glyphicon-thumbs-down"></span></span>
                </div>
            </div>
        </div>
    </template>

    <script src="../scripts/super-hero.js"></script>

    <script>
        var module = (function() {
            var fetch = function(id) {
                var storedHero = localStorage.getItem('hero.' + id);
                if (storedHero == null) { // Retrieve super-hero from Marvel server. Not for DEMO :o)
                    console.log('Hero not found, looking for Marvel server...');
                    var request = new XMLHttpRequest();
                    request.open('GET', 'http://gateway.marvel.com/v1/public/characters/' + id + '?apikey=52ee0500e06b3f33ae51bf0a8922100b', true);
                    request.onload = function() {
                        var x = request.responseText;
                        storedHero = JSON.parse(x).data.results[0];
                        localStorage.setItem('hero.' + id, JSON.stringify(storedHero));
                    };
                    request.send();
                }
                return JSON.parse(storedHero);
            };
            return {
                ready: function () {
                    this.hero = fetch(this.heroId);
                    console.dir(this.hero);
                    this.wins = 0;
                    this.losses = 0;
                },
                get success() {
                    if (this.wins + this.losses == 0) {
                        return '-';
                    }
                    return Math.floor((this.wins / (this.wins + this.losses)) * 100);
                },
                win: function() {
                    this.wins++;
                    var animation = winnerAnimation(this.$.box);
                    document.timeline.play(animation);
                },
                loose: function() {
                    this.losses++;
                    var animation = loserAnimation(this.$.box);
                    document.timeline.play(animation);
                }
            }
        })();
        Polymer('super-hero', module);
    </script>
</polymer-element>
